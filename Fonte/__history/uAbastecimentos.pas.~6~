unit uAbastecimentos;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, uCadastros, Data.DB, Vcl.Grids, Vcl.DBGrids, Vcl.StdCtrls, Vcl.ComCtrls, Vcl.Buttons,
  Vcl.ExtCtrls, dmPrincipal, StrUtils, UITypes;

type
  TFormAbastecimentos = class(TFormPadrao)
    procedure btnFiltroClick(Sender: TObject);
    procedure btnNovoClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
    procedure InicializarTela;
    procedure NovoRegistro;
  public
    { Public declarations }
  end;

var
  FormAbastecimentos: TFormAbastecimentos;

implementation

{$R *.dfm}

{ TFormPadrao1 }

procedure TFormAbastecimentos.btnFiltroClick(Sender: TObject);
  function ValidaData(Value:string):Boolean;
  begin
    try
      StrToDate(Value);
      Result := true;
    except
      Result := false;
    end;
  end;
begin
  inherited;
  if not (SameText(Trim(edtFiltro.Text),'')) then
  begin
    if ValidaData(edtFiltro.Text) then
    begin
      QGrid.Filtered := false;
      QGrid.Filter   := 'Dia = '+QuotedStr(edtFiltro.Text);
      QGrid.Filtered := true;
    end
    else
    begin
      MessageDlg('Informe uma data válida!',TMsgDlgType.mtWarning,[TMsgDlgBtn.mbOK],0,TMsgDlgBtn.mbOK);
      edtFiltro.SetFocus;
    end;
  end
  else
    QGrid.Filtered := false;
end;

procedure TFormAbastecimentos.btnNovoClick(Sender: TObject);
begin
  inherited;
  NovoRegistro;
end;

procedure TFormAbastecimentos.FormCreate(Sender: TObject);
begin
  inherited;
  InicializarTela;
end;

procedure TFormAbastecimentos.InicializarTela;
var
i:integer;
Coluna:TColumn;
begin
  QGrid.SQL.Clear;
  QGrid.SQL.Add(dm.SQLAbastecimento);
  QGrid.Open;
  for i := 0 to QGrid.FieldCount-1 do
  begin
    Coluna           := GridRegistros.Columns.Add();
    Coluna.FieldName := QGrid.Fields[i].FieldName;
    case IndexStr(UpperCase(QGrid.Fields[i].FieldName),['ID','ID_BOMBA','DESCBOMBA','DIA','LITROS','VALOR','ALIQUOTA','IMPOSTO']) of
      0:Coluna.Title.Caption := 'Código';
      1:Coluna.Visible       := false;
      2:Coluna.Title.Caption := 'Bomba';
      3:Coluna.Title.Caption := 'Dia';
      4:Coluna.Title.Caption := 'Litros';
      5:Coluna.Title.Caption := 'Valor';
      6:Coluna.Title.Caption := 'Aliquota';
      7:Coluna.Title.Caption := 'Imposto';
    end;
  end;

end;

procedure TFormAbastecimentos.NovoRegistro;
begin
  QGrid.Transaction.StartTransaction;
  QGrid.Append;
  QGrid.FieldByName('Id').AsInteger := NovoId('ABASTECIMENTOS');
end;

end.
